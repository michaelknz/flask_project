<html>
    <head>
        <meta charset = "utf-8">
        <title>drop</title>
        <script>



function randWordPos(){
    return Math.floor(Math.random() * (window.innerWidth-30 - 0)) + 0;
}

function randWordSpeed(){
    return Math.floor(Math.random() * (8 - 1)) + 1;
}

function wordInList(mas,val){
    return wordList.some(arrVal => val === arrVal.text)
}


function board(width, height) {
    this.width = width;
    this.height = height;
    this.draw = function() {
        context.fillStyle = "#000";
        context.fillRect(0, 0, this.width, this.height);
    };
}
function word(x, y, text,length) {
    this.color = "#fff";
    this.x = x;
    this.y = y;
    this.speed = randWordSpeed()
    this.text = text;
    this.colored = ""
    this.length = length;
    this.draw = function() {
        context.fillStyle = this.color;
        context.font = "italic 30pt Arial";
        context.fillText(this.colored, this.x, this.y, this.length);
        context.fillText(this.text, this.x, this.y, this.length);

    };
    this.update = function () {
    if (this.y>board.height) {
        clearInterval(game);
        gameover(0);
    }
    this.y += this.speed;

}
}

function draw() {
    board.draw();
    for (let i in wordList){
    wordList[i].draw()
    }

}



function play() {
    draw();
    for (let i in wordList){
    wordList[i].update()
    }

    if (wordList.length == 0){
        if (bank){
        for (let w = 0; w<6;w++){
            wordList.push(new word(randWordPos(), 20, bank[0]))
            bank.shift()
            }

        }
        if (!bank){
        gameover(1)
        }
    }

}

function typing(){
    document.onkeypress = (e)=>{
        const k = e.key
        if (k == "`"){
        clearInterval(game)
        paused()
        }
        if (k != " "){
        keyLog += k
        }
    }

    if (event.code == "Space"){
        keyLog.trim()
        if (wordInList(wordList,keyLog)){
        let w = []
        for (i in wordList){
        w.push(wordList[i].text)
        }
        wordList.splice(w.indexOf(keyLog),1)

        }
    keyLog = ""
    }



}

function init() {

stupidWordBank = "Smile for the camera "+
"Another politician bought "+
"I swear I heard another shot "+
"Cash another payment "+
"Red all on the canvas "+
"It's murder on the campus "+
"Another press conference "+
"Nothing gets accomplished "+
"The suit is an accomplice "+
"Money is the motive "+
"The war is in the street "+
"Watch history repeat";

    board = new board(window.innerWidth, window.innerHeight);

    bank = stupidWordBank.split(" ")

    wordList = []
    for (let w = 0; w<6;w++){
        wordList.push(new word(randWordPos(), 20, bank[0]))
        bank.shift()

    }


    canvas = document.getElementById("drop");
    canvas.width = board.width;
    canvas.height = board.height;
    context = canvas.getContext("2d");

    keyLog = ""
    addEventListener("keydown", typing);


    game = setInterval(play, 100);


}

function gameover(n){
    if (n == 0){
    board.draw()
    ga = new word(board.width/2-100,board.height/2,"GAME OVER",250)
    ga.draw()
    }

    if (n == 1){
    board.draw()
    ga = new word(board.width/2-100,board.height/2,"YOU WIN",250)
    ga.draw()
    }

}

function paused(){

removeEventListener("keydown", typing);
addEventListener("keydown", paused);
p = new word(board.width/2-100,board.height/2,"PAUSED",250)
l = new word(board.width/2-100,board.height/2+50,"Press 1 - Main page",250)
p.draw()
l.draw()
document.onkeypress = (e)=>{
        const k = e.key
        if (k == "`"){
        removeEventListener("keydown", paused);
        addEventListener("keyup", typing);
        game = setInterval(play, 100);
        }
        if (k=="1"){
        history.back()
        }
    }


}
        </script>
    </head>
    <body>
        <canvas id="drop">wtf?!</canvas>
        <script>init()</script>
    </body>
</html>